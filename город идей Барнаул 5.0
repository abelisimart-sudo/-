```html
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ì–û–†–û–î –ò–î–ï–ô ‚Äî –ë–ê–†–ù–ê–£–õ | –¢–≤–æ–π –≥–æ–ª–æ—Å = —Ä–µ–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* ========== –û–°–ù–û–í–ù–´–ï –°–¢–ò–õ–ò ========== */
        :root {
            --primary: #2563EB;
            --primary-dark: #1D4ED8;
            --primary-light: #60A5FA;
            --secondary: #8B5CF6;
            --success: #10B981;
            --warning: #F59E0B;
            --danger: #EF4444;
            --dark: #1E293B;
            --gray: #64748B;
            --light: #F8FAFC;
            --gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-primary: linear-gradient(135deg, var(--primary), var(--secondary));
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }
        
        html {
            scroll-behavior: smooth;
        }
        
        body {
            background: var(--gradient);
            min-height: 100vh;
            color: var(--dark);
            overflow-x: hidden;
        }
        
        /* ========== –®–ê–ü–ö–ê ========== */
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
            border-bottom: 2px solid rgba(255, 255, 255, 0.3);
            animation: slideDown 0.5s ease-out;
        }
        
        @keyframes slideDown {
            from { transform: translateY(-100%); }
            to { transform: translateY(0); }
        }
        
        .nav-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .logo-icon {
            width: 48px;
            height: 48px;
            background: var(--gradient-primary);
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.4rem;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(37, 99, 235, 0.4); }
            70% { box-shadow: 0 0 0 15px rgba(37, 99, 235, 0); }
            100% { box-shadow: 0 0 0 0 rgba(37, 99, 235, 0); }
        }
        
        .logo-text {
            font-weight: 900;
            font-size: 1.8rem;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: -0.5px;
        }
        
        .logo-subtitle {
            font-size: 0.9rem;
            color: var(--gray);
            margin-top: 2px;
        }
        
        /* === –†–ï–ñ–ò–ú –ê–î–ú–ò–ù/–ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨ === */
        .mode-switcher {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-right: 1rem;
            background: rgba(37, 99, 235, 0.1);
            padding: 0.5rem 1rem;
            border-radius: 12px;
        }
        
        .mode-label {
            font-weight: 600;
            color: var(--gray);
            font-size: 0.9rem;
        }
        
        .mode-toggle {
            display: flex;
            background: white;
            border-radius: 10px;
            padding: 0.25rem;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        
        .mode-btn {
            padding: 0.4rem 0.8rem;
            border: none;
            border-radius: 8px;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            background: transparent;
            color: var(--gray);
        }
        
        .mode-btn.active {
            background: var(--gradient-primary);
            color: white;
        }
        
        .nav-tabs {
            display: flex;
            gap: 0.5rem;
            background: rgba(37, 99, 235, 0.1);
            padding: 0.5rem;
            border-radius: 16px;
        }
        
        .tab-btn {
            background: transparent;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 12px;
            font-weight: 600;
            color: var(--gray);
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            gap: 8px;
            position: relative;
        }
        
        .tab-btn:hover {
            color: var(--primary);
            background: rgba(255, 255, 255, 0.9);
        }
        
        .tab-btn.active {
            background: white;
            color: var(--primary);
            box-shadow: 0 4px 20px rgba(37, 99, 235, 0.15);
        }
        
        .tab-badge {
            background: var(--primary);
            color: white;
            font-size: 0.7rem;
            padding: 2px 6px;
            border-radius: 10px;
            margin-left: 5px;
        }
        
        /* ========== –ì–õ–ê–í–ù–´–ô –ö–û–ù–¢–ï–ô–ù–ï–† ========== */
        .main-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .page {
            display: none;
            animation: fadeIn 0.5s ease-out;
        }
        
        .page.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* ========== –°–¢–†–ê–ù–ò–¶–ê –ò–ì–†–´ (–ì–õ–ê–í–ù–ê–Ø) ========== */
        .game-hero {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 28px;
            padding: 3rem;
            margin-bottom: 2rem;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.2);
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .hero-title {
            font-size: 3.5rem;
            font-weight: 900;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 1rem;
            line-height: 1.2;
        }
        
        .hero-subtitle {
            font-size: 1.4rem;
            color: var(--gray);
            max-width: 800px;
            margin: 0 auto 2rem;
            line-height: 1.6;
        }
        
        .city-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 2rem;
            margin: 3rem 0;
        }
        
        .stat-card {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }
        
        .stat-value {
            font-size: 3rem;
            font-weight: 900;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }
        
        .stat-label {
            color: var(--gray);
            font-size: 1rem;
        }
        
        .progress-section {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            margin: 2rem 0;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
        }
        
        .progress-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            color: var(--dark);
        }
        
        .progress-bar {
            height: 24px;
            background: var(--light);
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 1rem;
        }
        
        .progress-fill {
            height: 100%;
            background: var(--gradient-primary);
            border-radius: 12px;
            transition: width 1s ease-out;
            position: relative;
            overflow: hidden;
        }
        
        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            animation: shimmer 2s infinite;
        }
        
        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        .progress-info {
            display: flex;
            justify-content: space-between;
            color: var(--gray);
            font-size: 0.9rem;
        }
        
        /* ========== QR-–°–ï–ö–¶–ò–Ø ========== */
        .qr-section {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            border-radius: 28px;
            padding: 3rem;
            text-align: center;
            margin: 3rem 0;
            position: relative;
            overflow: hidden;
        }
        
        .qr-section::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(37, 99, 235, 0.1) 0%, transparent 70%);
            animation: rotate 20s linear infinite;
        }
        
        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .qr-title {
            font-size: 2.5rem;
            font-weight: 900;
            color: var(--dark);
            margin-bottom: 1rem;
            position: relative;
        }
        
        .qr-subtitle {
            font-size: 1.2rem;
            color: var(--gray);
            margin-bottom: 2rem;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            position: relative;
        }
        
        .qr-container {
            display: inline-block;
            padding: 30px;
            background: white;
            border-radius: 24px;
            box-shadow: 0 20px 60px rgba(37, 99, 235, 0.2);
            margin: 2rem 0;
            position: relative;
            animation: float 3s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        .qr-placeholder {
            width: 250px;
            height: 250px;
            background: #f8fafc;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            color: var(--primary-light);
            border: 3px dashed var(--primary-light);
        }
        
        .qr-instructions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
            margin-top: 3rem;
            position: relative;
        }
        
        .qr-step {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            text-align: center;
        }
        
        .qr-step-number {
            width: 50px;
            height: 50px;
            background: var(--gradient-primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 1.5rem;
            margin: 0 auto 1rem;
        }
        
        /* ========== –ö–ê–†–¢–ê ========== */
        .map-container {
            background: white;
            border-radius: 28px;
            padding: 2rem;
            margin: 2rem 0;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
        }
        
        .map-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        
        #map {
            height: 500px;
            border-radius: 20px;
            overflow: hidden;
            border: 3px solid white;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.1);
        }
        
        /* ========== –°–¢–†–ê–ù–ò–¶–ê –ü–†–û–§–ò–õ–Ø ========== */
        .profile-header {
            background: white;
            border-radius: 28px;
            padding: 3rem;
            margin-bottom: 2rem;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
            text-align: center;
        }
        
        .user-level {
            font-size: 1.2rem;
            color: var(--primary);
            font-weight: 600;
            margin-bottom: 1rem;
        }
        
        .user-name {
            font-size: 2.5rem;
            font-weight: 900;
            color: var(--dark);
            margin-bottom: 0.5rem;
        }
        
        .badges-container {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            justify-content: center;
            margin: 2rem 0;
        }
        
        .badge {
            background: white;
            border-radius: 20px;
            padding: 1.5rem;
            text-align: center;
            width: 150px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s;
        }
        
        .badge:hover {
            transform: scale(1.05);
        }
        
        .badge-icon {
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }
        
        .badge.locked {
            opacity: 0.3;
            filter: grayscale(1);
        }
        
        /* ========== –°–¢–†–ê–ù–ò–¶–ê –†–ï–ô–¢–ò–ù–ì–ê ========== */
        .rating-filters {
            background: white;
            border-radius: 20px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }
        
        .location-card {
            background: white;
            border-radius: 20px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            gap: 1.5rem;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .location-card:hover {
            transform: translateX(10px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
        }
        
        .location-rank {
            font-size: 2rem;
            font-weight: 900;
            color: var(--primary);
            min-width: 60px;
        }
        
        .location-rating {
            font-size: 1.8rem;
            font-weight: 900;
            color: var(--dark);
        }
        
        .rating-indicator {
            width: 10px;
            height: 40px;
            border-radius: 5px;
        }
        
        .rating-indicator.high { background: var(--success); }
        .rating-indicator.medium { background: var(--warning); }
        .rating-indicator.low { background: var(--danger); }
        .rating-indicator.none { background: var(--gray); opacity: 0.3; }
        
        /* ========== –°–¢–†–ê–ù–ò–¶–ê –ò–î–ï–ô ========== */
        .ideas-container {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 2rem;
        }
        
        .idea-form {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }
        
        .idea-list {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            max-height: 600px;
            overflow-y: auto;
        }
        
        .idea-item {
            padding: 1.5rem;
            border-bottom: 1px solid var(--light);
        }
        
        .idea-status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .status-pending { background: #FEF3C7; color: #92400E; }
        .status-review { background: #DBEAFE; color: #1E40AF; }
        .status-progress { background: #D1FAE5; color: #065F46; }
        .status-done { background: #D1FAE5; color: #065F46; }
        
        /* ========== –°–¢–†–ê–ù–ò–¶–ê –ê–ù–ê–õ–ò–¢–ò–ö–ò ========== */
        .analytics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 2rem;
        }
        
        .chart-container {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }
        
        .export-buttons {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
        }
        
        /* ========== –ú–û–î–ê–õ–¨–ù–´–ï –û–ö–ù–ê ========== */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            padding: 20px;
            animation: fadeIn 0.3s ease-out;
        }
        
        .modal-content {
            background: white;
            border-radius: 28px;
            padding: 3rem;
            max-width: 800px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            animation: scaleIn 0.3s ease-out;
        }
        
        @keyframes scaleIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }
        
        .close-modal {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            font-size: 2rem;
            cursor: pointer;
            color: var(--gray);
        }
        
        /* ========== –§–û–†–ú–´ ========== */
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--dark);
        }
        
        .form-control {
            width: 100%;
            padding: 1rem;
            border: 2px solid #E5E7EB;
            border-radius: 12px;
            font-size: 1rem;
            transition: all 0.3s;
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }
        
        .star-rating {
            display: flex;
            gap: 5px;
            margin-top: 0.5rem;
        }
        
        .star {
            font-size: 2rem;
            color: #E5E7EB;
            cursor: pointer;
            transition: color 0.2s;
        }
        
        .star:hover, .star.active {
            color: var(--warning);
        }
        
        /* ========== –ö–ù–û–ü–ö–ò ========== */
        .btn {
            padding: 1rem 2rem;
            border-radius: 12px;
            border: none;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }
        
        .btn-primary {
            background: var(--gradient-primary);
            color: white;
            box-shadow: 0 10px 30px rgba(37, 99, 235, 0.3);
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 40px rgba(37, 99, 235, 0.4);
        }
        
        .btn-secondary {
            background: white;
            color: var(--primary);
            border: 2px solid var(--primary-light);
        }
        
        .btn-large {
            padding: 1.2rem 2.5rem;
            font-size: 1.1rem;
        }
        
        /* ========== –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø ========== */
        .notification {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: white;
            border-radius: 16px;
            padding: 1.5rem;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            gap: 1rem;
            z-index: 3000;
            animation: slideInRight 0.3s ease-out;
            max-width: 400px;
        }
        
        @keyframes slideInRight {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }
        
        .notification.hidden {
            display: none;
        }
        
        /* ========== –ê–î–ê–ü–¢–ò–í–ù–û–°–¢–¨ ========== */
        @media (max-width: 1024px) {
            .ideas-container {
                grid-template-columns: 1fr;
            }
            
            .analytics-grid {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 768px) {
            .nav-container {
                flex-direction: column;
                gap: 1rem;
            }
            
            .nav-tabs {
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .hero-title {
                font-size: 2.5rem;
            }
            
            .city-stats {
                grid-template-columns: 1fr;
            }
            
            .qr-instructions {
                grid-template-columns: 1fr;
            }
        }
        
        /* ========== –ê–ù–ò–ú–ê–¶–ò–ò ========== */
        .confetti {
            position: fixed;
            width: 15px;
            height: 15px;
            background: var(--primary);
            opacity: 0;
            z-index: 9999;
            animation: confetti-fall 1s ease-out forwards;
        }
        
        @keyframes confetti-fall {
            0% {
                transform: translateY(-100px) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }
    </style>
</head>
<body>
    <!-- –®–∞–ø–∫–∞ -->
    <header class="header">
        <div class="nav-container">
            <div class="logo">
                <div class="logo-icon">
                    <i class="fas fa-lightbulb"></i>
                </div>
                <div>
                    <div class="logo-text">–ì–û–†–û–î –ò–î–ï–ô</div>
                    <div class="logo-subtitle">–ë–ê–†–ù–ê–£–õ | –¢–≤–æ–π –≥–æ–ª–æ—Å = —Ä–µ–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è</div>
                </div>
            </div>
            
            <div style="display: flex; align-items: center;">
                <!-- –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ä–µ–∂–∏–º–∞ -->
                <div class="mode-switcher">
                    <div class="mode-label">–†–µ–∂–∏–º:</div>
                    <div class="mode-toggle">
                        <button class="mode-btn active" data-mode="user">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</button>
                        <button class="mode-btn" data-mode="admin">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</button>
                    </div>
                </div>
                
                <div class="nav-tabs">
                    <button class="tab-btn active" data-page="game">
                        <i class="fas fa-gamepad"></i> –ò–≥—Ä–∞
                        <span class="tab-badge" id="gameBadge">!</span>
                    </button>
                    <button class="tab-btn" data-page="profile">
                        <i class="fas fa-user"></i> –ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å
                    </button>
                    <button class="tab-btn" data-page="rating">
                        <i class="fas fa-chart-line"></i> –†–µ–π—Ç–∏–Ω–≥
                    </button>
                    <button class="tab-btn" data-page="ideas">
                        <i class="fas fa-lightbulb"></i> –ò–¥–µ–∏
                    </button>
                    <button class="tab-btn" data-page="analytics">
                        <i class="fas fa-chart-bar"></i> –ê–Ω–∞–ª–∏—Ç–∏–∫–∞
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- –ì–ª–∞–≤–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä -->
    <main class="main-container">
        <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ 1: –ò–ì–†–ê -->
        <div class="page active" id="game">
            <div class="game-hero">
                <h1 class="hero-title">üéÆ –°–û–ó–î–ê–ô –ò–î–ï–ê–õ–¨–ù–´–ô –ë–ê–†–ù–ê–£–õ</h1>
                <p class="hero-subtitle">
                    –≠—Ç–æ –Ω–µ –ø—Ä–æ—Å—Ç–æ –æ—Ü–µ–Ω–∫–∞ ‚Äî —ç—Ç–æ –∏–≥—Ä–∞, –≥–¥–µ —Ç—ã —Å—Ç–∞–Ω–æ–≤–∏—à—å—Å—è —Å–æ–∞–≤—Ç–æ—Ä–æ–º –≥–æ—Ä–æ–¥–∞.<br>
                    –ö–∞–∂–¥–∞—è —Ç–≤–æ—è –æ—Ü–µ–Ω–∫–∞ –ø—Ä–∏–±–ª–∏–∂–∞–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –Ω–∞—à–µ–º –ª—é–±–∏–º–æ–º –≥–æ—Ä–æ–¥–µ.
                </p>
                
                <div class="city-stats">
                    <div class="stat-card">
                        <div class="stat-value" id="totalRatings">0</div>
                        <div class="stat-label">–æ—Ü–µ–Ω–æ–∫ –æ—Ç –∂–∏—Ç–µ–ª–µ–π</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="totalIdeas">0</div>
                        <div class="stat-label">–ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã—Ö –∏–¥–µ–π</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="activeUsers">0</div>
                        <div class="stat-label">–∞–∫—Ç–∏–≤–Ω—ã—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="completedIdeas">0</div>
                        <div class="stat-label">—Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö —É–ª—É—á—à–µ–Ω–∏–π</div>
                    </div>
                </div>
                
                <div class="progress-section">
                    <h3 class="progress-title">üèÜ –¶–µ–ª—å –≥–æ—Ä–æ–¥–∞: 1000 –æ—Ü–µ–Ω–æ–∫ –¥–ª—è —Ä–µ–∞–ª—å–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π</h3>
                    <div class="progress-bar">
                        <div class="progress-fill" id="cityProgress" style="width: 0%"></div>
                    </div>
                    <div class="progress-info">
                        <span>–ù–∞—á–∏–Ω–∞–µ–º –ø—É—Ç—å</span>
                        <span id="progressText">0/1000 –æ—Ü–µ–Ω–æ–∫</span>
                        <span>–ò–¥–µ–∞–ª—å–Ω—ã–π –≥–æ—Ä–æ–¥</span>
                    </div>
                </div>
            </div>

            <!-- QR-—Å–µ–∫—Ü–∏—è -->
            <div class="qr-section">
                <h2 class="qr-title">üì± –ü–†–ò–ì–õ–ê–°–ò –î–†–£–ó–ï–ô –í –ò–ì–†–£!</h2>
                <p class="qr-subtitle">
                    –ü–æ–¥–µ–ª–∏—Å—å —Å—Å—ã–ª–∫–æ–π —Å –¥—Ä—É–∑—å—è–º–∏, —á—Ç–æ–±—ã –≤–º–µ—Å—Ç–µ —Å–¥–µ–ª–∞—Ç—å –ë–∞—Ä–Ω–∞—É–ª –ª—É—á—à–µ!<br>
                    –í–º–µ—Å—Ç–µ –º—ã —Å–æ–∑–¥–∞–¥–∏–º –∏–¥–µ–∞–ª—å–Ω—ã–π –≥–æ—Ä–æ–¥.
                </p>
                
                <div class="qr-container">
                    <div class="qr-placeholder" id="qrPlaceholder">
                        <i class="fas fa-image"></i>
                    </div>
                </div>
                
                <p style="margin-top: 1rem; color: var(--gray); font-size: 0.9rem;">
                    –°—Å—ã–ª–∫–∞ –¥–ª—è –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è: <strong id="appLink">–≥–æ—Ä–æ–¥-–∏–¥–µ–π.–±–∞—Ä–Ω–∞—É–ª</strong>
                </p>
                
                <div class="qr-instructions">
                    <div class="qr-step">
                        <div class="qr-step-number">1</div>
                        <h4>–ü–æ–¥–µ–ª–∏—Å—å —Å—Å—ã–ª–∫–æ–π</h4>
                        <p>–ü—Ä–∏–≥–ª–∞—Å–∏ –¥—Ä—É–∑–µ–π –≤ –∏–≥—Ä—É</p>
                    </div>
                    <div class="qr-step">
                        <div class="qr-step-number">2</div>
                        <h4>–û—Ü–µ–Ω–∏ 3 –º–µ—Å—Ç–∞</h4>
                        <p>–°—Ç–∞–Ω—å "–ñ–∏—Ç–µ–ª–µ–º" –∏–≥—Ä—ã</p>
                    </div>
                    <div class="qr-step">
                        <div class="qr-step-number">3</div>
                        <h4>–ü—Ä–µ–¥–ª–æ–∂–∏ –∏–¥–µ—é</h4>
                        <p>–°—Ç–∞–Ω—å "–°–æ–∑–¥–∞—Ç–µ–ª–µ–º –≥–æ—Ä–æ–¥–∞"</p>
                    </div>
                </div>
            </div>

            <!-- –ö–∞—Ä—Ç–∞ -->
            <div class="map-container">
                <div class="map-header">
                    <h2 style="font-size: 1.8rem; font-weight: 700; color: var(--dark);">
                        <i class="fas fa-map-marked-alt"></i> 10 —Ç–æ—á–µ–∫ –ë–∞—Ä–Ω–∞—É–ª–∞ –∂–¥—É—Ç —Ç–≤–æ–µ–π –æ—Ü–µ–Ω–∫–∏
                    </h2>
                    <button class="btn btn-secondary" onclick="showAllLocations()">
                        <i class="fas fa-eye"></i> –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ
                    </button>
                </div>
                <div id="map"></div>
            </div>

            <!-- –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è -->
            <div class="progress-section">
                <h3 class="progress-title">üèÖ –¢–≤–æ–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –≤ –∏–≥—Ä–µ</h3>
                <div class="badges-container" id="userBadgesPreview">
                    <!-- –ë–µ–π–¥–∂–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JS -->
                </div>
                <button class="btn btn-primary" onclick="switchPage('profile')">
                    <i class="fas fa-trophy"></i> –°–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è
                </button>
            </div>
        </div>

        <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ 2: –ü–†–û–§–ò–õ–¨ -->
        <div class="page" id="profile">
            <div class="profile-header">
                <div class="user-level" id="userLevel">–£—Ä–æ–≤–µ–Ω—å: –ñ–∏—Ç–µ–ª—å</div>
                <h1 class="user-name" id="userName">–ò–≥—Ä–æ–∫</h1>
                <p style="color: var(--gray); margin-bottom: 2rem;">–¢–≤–æ–π –≤–∫–ª–∞–¥ –≤ —Ä–∞–∑–≤–∏—Ç–∏–µ –≥–æ—Ä–æ–¥–∞</p>
                
                <div class="city-stats">
                    <div class="stat-card">
                        <div class="stat-value" id="userRatings">0</div>
                        <div class="stat-label">—Ç–≤–æ–∏—Ö –æ—Ü–µ–Ω–æ–∫</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="userIdeas">0</div>
                        <div class="stat-label">—Ç–≤–æ–∏—Ö –∏–¥–µ–π</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="userBadgesCount">0</div>
                        <div class="stat-label">—Ç–≤–æ–∏—Ö –±–µ–π–¥–∂–µ–π</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="userRank">#1</div>
                        <div class="stat-label">—Ç–≤–æ–π —Ä–µ–π—Ç–∏–Ω–≥</div>
                    </div>
                </div>
            </div>

            <div class="progress-section">
                <h3 class="progress-title">üìà –¢–≤–æ–π –ø—Ä–æ–≥—Ä–µ—Å—Å</h3>
                <div class="progress-bar">
                    <div class="progress-fill" id="userProgress" style="width: 0%"></div>
                </div>
                <div class="progress-info">
                    <span>–ù–æ–≤–∏—á–æ–∫</span>
                    <span id="userProgressText">0/10 –æ—Ü–µ–Ω–æ–∫</span>
                    <span>–≠–∫—Å–ø–µ—Ä—Ç –≥–æ—Ä–æ–¥–∞</span>
                </div>
            </div>

            <div class="progress-section">
                <h3 class="progress-title">üèÜ –¢–≤–æ–∏ –±–µ–π–¥–∂–∏</h3>
                <div class="badges-container" id="userBadgesFull">
                    <!-- –í—Å–µ –±–µ–π–¥–∂–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JS -->
                </div>
            </div>
        </div>

        <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ 3: –†–ï–ô–¢–ò–ù–ì -->
        <div class="page" id="rating">
            <div class="game-hero">
                <h1 class="hero-title">üìä –†–ï–ô–¢–ò–ù–ì –ì–û–†–û–î–ê</h1>
                <p class="hero-subtitle">
                    –ù–∞ –æ—Å–Ω–æ–≤–µ —Ä–µ–∞–ª—å–Ω—ã—Ö –æ—Ü–µ–Ω–æ–∫ –∂–∏—Ç–µ–ª–µ–π. –°–º–æ—Ç—Ä–∏, –∫–∞–∫–∏–µ –º–µ—Å—Ç–∞ –Ω—É–∂–¥–∞—é—Ç—Å—è –≤ —É–ª—É—á—à–µ–Ω–∏–∏,<br>
                    –∞ –∫–∞–∫–∏–µ —É–∂–µ —Å—Ç–∞–ª–∏ –ª—é–±–∏–º—ã–º–∏ —É –≥–æ—Ä–æ–∂–∞–Ω.
                </p>
            </div>

            <div class="rating-filters">
                <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                    <button class="btn btn-secondary" onclick="sortByRating()">
                        <i class="fas fa-star"></i> –ü–æ —Ä–µ–π—Ç–∏–Ω–≥—É
                    </button>
                    <button class="btn btn-secondary" onclick="sortByVotes()">
                        <i class="fas fa-users"></i> –ü–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –æ—Ü–µ–Ω–æ–∫
                    </button>
                    <button class="btn btn-secondary" onclick="filterByCategory()">
                        <i class="fas fa-filter"></i> –ü–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
                    </button>
                </div>
            </div>

            <div id="ratingList">
                <!-- –°–ø–∏—Å–æ–∫ –ª–æ–∫–∞—Ü–∏–π –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω —á–µ—Ä–µ–∑ JS -->
            </div>
        </div>

        <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ 4: –ò–î–ï–ò -->
        <div class="page" id="ideas">
            <div class="game-hero">
                <h1 class="hero-title">üí° –ü–†–ï–î–õ–û–ñ–ò –ò–î–ï–Æ</h1>
                <p class="hero-subtitle">
                    –í–∏–¥–∏—à—å, —á—Ç–æ –º–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å? –†–∞—Å—Å–∫–∞–∂–∏ –æ–± —ç—Ç–æ–º! –¢–≤–æ–∏ –∏–¥–µ–∏ –º–æ–≥—É—Ç —Å—Ç–∞—Ç—å —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å—é.<br>
                    –ö–∞–∂–¥–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞–µ—Ç—Å—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏–µ–π –≥–æ—Ä–æ–¥–∞.
                </p>
            </div>

            <div class="ideas-container">
                <div class="idea-form">
                    <h3 style="margin-bottom: 1.5rem; color: var(--dark);">–ù–æ–≤–∞—è –∏–¥–µ—è</h3>
                    <form id="ideaForm" onsubmit="submitIdea(event)">
                        <div class="form-group">
                            <label class="form-label">–í—ã–±–µ—Ä–∏—Ç–µ –º–µ—Å—Ç–æ</label>
                            <select class="form-control" id="ideaLocation" required>
                                <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –æ–±—ä–µ–∫—Ç --</option>
                                <!-- –û–ø—Ü–∏–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JS -->
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                            <select class="form-control" id="ideaCategory" required>
                                <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é --</option>
                                <option value="cleanliness">–ß–∏—Å—Ç–æ—Ç–∞ –∏ —É–±–æ—Ä–∫–∞</option>
                                <option value="facilities">–°–∫–∞–º–µ–π–∫–∏, —É—Ä–Ω—ã, –æ—Å–≤–µ—â–µ–Ω–∏–µ</option>
                                <option value="greenery">–û–∑–µ–ª–µ–Ω–µ–Ω–∏–µ</option>
                                <option value="safety">–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å</option>
                                <option value="infrastructure">–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞</option>
                                <option value="other">–î—Ä—É–≥–æ–µ</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">–û–ø–∏—à–∏—Ç–µ –≤–∞—à—É –∏–¥–µ—é</label>
                            <textarea class="form-control" id="ideaDescription" rows="4" 
                                      placeholder="–ß—Ç–æ –≤—ã –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç–µ —É–ª—É—á—à–∏—Ç—å?..." required></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">–í–∞—à email (–¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏)</label>
                            <input type="email" class="form-control" id="ideaEmail" 
                                   placeholder="email@example.com">
                        </div>
                        
                        <button type="submit" class="btn btn-primary" style="width: 100%;">
                            <i class="fas fa-paper-plane"></i> –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∏–¥–µ—é
                        </button>
                    </form>
                </div>

                <div class="idea-list">
                    <h3 style="margin-bottom: 1.5rem; color: var(--dark);">–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã–µ –∏–¥–µ–∏</h3>
                    <div id="ideasList">
                        <!-- –°–ø–∏—Å–æ–∫ –∏–¥–µ–π –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω —á–µ—Ä–µ–∑ JS -->
                    </div>
                </div>
            </div>
        </div>

        <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ 5: –ê–ù–ê–õ–ò–¢–ò–ö–ê -->
        <div class="page" id="analytics">
            <div class="game-hero">
                <h1 class="hero-title">üìà –ê–ù–ê–õ–ò–¢–ò–ö–ê</h1>
                <p class="hero-subtitle">
                    –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≥–æ—Ä–æ–¥–∞.<br>
                    –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç—á—ë—Ç–æ–≤ –∏ –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏–π.
                </p>
            </div>

            <div class="analytics-grid">
                <div class="chart-container">
                    <h3 style="margin-bottom: 1.5rem; color: var(--dark);">–û—Ü–µ–Ω–∫–∏ –ø–æ –∫—Ä–∏—Ç–µ—Ä–∏—è–º</h3>
                    <canvas id="criteriaChart"></canvas>
                </div>
                
                <div class="chart-container">
                    <h3 style="margin-bottom: 1.5rem; color: var(--dark);">–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ –¥–Ω—è–º</h3>
                    <canvas id="activityChart"></canvas>
                </div>
                
                <div class="chart-container">
                    <h3 style="margin-bottom: 1.5rem; color: var(--dark);">–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∏–¥–µ–π</h3>
                    <canvas id="ideasChart"></canvas>
                </div>
                
                <div class="chart-container">
                    <h3 style="margin-bottom: 1.5rem; color: var(--dark);">–¢–æ–ø –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –º–µ—Å—Ç</h3>
                    <canvas id="problemsChart"></canvas>
                </div>
            </div>

            <div class="progress-section">
                <h3 class="progress-title">üìä –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</h3>
                <div class="export-buttons">
                    <button class="btn btn-primary" onclick="exportData('csv')">
                        <i class="fas fa-file-csv"></i> –≠–∫—Å–ø–æ—Ä—Ç –≤ CSV
                    </button>
                    <button class="btn btn-primary" onclick="exportData('pdf')">
                        <i class="fas fa-file-pdf"></i> –≠–∫—Å–ø–æ—Ä—Ç –≤ PDF
                    </button>
                    <button class="btn btn-secondary" onclick="exportData('json')">
                        <i class="fas fa-code"></i> –≠–∫—Å–ø–æ—Ä—Ç –≤ JSON
                    </button>
                </div>
            </div>
        </div>
    </main>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –æ—Ü–µ–Ω–∫–∏ -->
    <div class="modal" id="ratingModal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeRatingModal()">&times;</button>
            <h2 id="ratingLocationName" style="margin-bottom: 1rem; color: var(--dark);"></h2>
            
            <div id="photoUploadSection" style="margin-bottom: 2rem;">
                <label class="form-label">–§–æ—Ç–æ –º–µ—Å—Ç–∞ (–º–æ–∂–µ—Ç –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å –∫–∞–∂–¥—ã–π, –¥–æ–±–∞–≤–ª—è–µ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä)</label>
                <div id="photoUploadArea" style="border: 2px dashed var(--primary-light); border-radius: 12px; padding: 2rem; text-align: center; cursor: pointer;"
                     onclick="if (isAdminMode) document.getElementById('photoInput').click(); else showNotification('–ó–∞–≥—Ä—É–∑–∫—É —Ñ–æ—Ç–æ –º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä', 'info')">
                    <i class="fas fa-cloud-upload-alt" style="font-size: 3rem; color: var(--primary-light); margin-bottom: 1rem;"></i>
                    <p id="photoUploadText">–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–æ—Ç–æ —Å—é–¥–∞ –∏–ª–∏ –∫–ª–∏–∫–Ω–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞</p>
                    <p style="font-size: 0.9rem; color: var(--gray); margin-top: 0.5rem;">
                        –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –¥–æ–±–∞–≤–∏—Ç —Ñ–æ—Ç–æ –ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
                    </p>
                </div>
                <input type="file" id="photoInput" accept="image/*" style="display: none;">
                <img id="photoPreview" style="max-width: 100%; border-radius: 12px; margin-top: 1rem; display: none;">
            </div>
            
            <div class="rating-form">
                <h3 style="margin-bottom: 1.5rem; color: var(--dark);">–û—Ü–µ–Ω–∏—Ç–µ –ø–æ 5-–±–∞–ª–ª—å–Ω–æ–π —à–∫–∞–ª–µ:</h3>
                
                <div class="form-group">
                    <label class="form-label">–ß–∏—Å—Ç–æ—Ç–∞ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏</label>
                    <div class="star-rating" id="cleanlinessRating">
                        <span class="star" data-value="1">‚òÖ</span>
                        <span class="star" data-value="2">‚òÖ</span>
                        <span class="star" data-value="3">‚òÖ</span>
                        <span class="star" data-value="4">‚òÖ</span>
                        <span class="star" data-value="5">‚òÖ</span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">–°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∫–∞–º–µ–µ–∫, —É—Ä–Ω, –æ—Å–≤–µ—â–µ–Ω–∏—è</label>
                    <div class="star-rating" id="facilitiesRating">
                        <span class="star" data-value="1">‚òÖ</span>
                        <span class="star" data-value="2">‚òÖ</span>
                        <span class="star" data-value="3">‚òÖ</span>
                        <span class="star" data-value="4">‚òÖ</span>
                        <span class="star" data-value="5">‚òÖ</span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">–ó–¥–æ—Ä–æ–≤—å–µ –¥–µ—Ä–µ–≤—å–µ–≤ –∏ –≥–∞–∑–æ–Ω–æ–≤</label>
                    <div class="star-rating" id="greeneryRating">
                        <span class="star" data-value="1">‚òÖ</span>
                        <span class="star" data-value="2">‚òÖ</span>
                        <span class="star" data-value="3">‚òÖ</span>
                        <span class="star" data-value="4">‚òÖ</span>
                        <span class="star" data-value="5">‚òÖ</span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å</label>
                    <div class="star-rating" id="safetyRating">
                        <span class="star" data-value="1">‚òÖ</span>
                        <span class="star" data-value="2">‚òÖ</span>
                        <span class="star" data-value="3">‚òÖ</span>
                        <span class="star" data-value="4">‚òÖ</span>
                        <span class="star" data-value="5">‚òÖ</span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">–û–±—â–µ–µ –≤–ø–µ—á–∞—Ç–ª–µ–Ω–∏–µ</label>
                    <div class="star-rating" id="overallRating">
                        <span class="star" data-value="1">‚òÖ</span>
                        <span class="star" data-value="2">‚òÖ</span>
                        <span class="star" data-value="3">‚òÖ</span>
                        <span class="star" data-value="4">‚òÖ</span>
                        <span class="star" data-value="5">‚òÖ</span>
                    </div>
                </div>
                
                <button class="btn btn-primary" onclick="submitLocationRating()" style="width: 100%;">
                    <i class="fas fa-star"></i> –û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ü–µ–Ω–∫—É
                </button>
            </div>
        </div>
    </div>

    <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ -->
    <div class="notification hidden" id="notification">
        <div id="notificationIcon" style="font-size: 2rem;"></div>
        <div>
            <strong id="notificationTitle"></strong>
            <p id="notificationMessage"></p>
        </div>
    </div>

    <script>
        // ========== –ö–û–ù–°–¢–ê–ù–¢–´ –ò –ü–ï–†–ï–ú–ï–ù–ù–´–ï ==========
        const BADGES = {
            firstRating: { icon: 'üè†', name: '–ü–µ—Ä–≤–∞—è –æ—Ü–µ–Ω–∫–∞', desc: '–û—Ü–µ–Ω–∏–ª —Å–≤–æ—ë –ø–µ—Ä–≤–æ–µ –º–µ—Å—Ç–æ', earned: false },
            cleanExpert: { icon: 'üßπ', name: '–≠–∫—Å–ø–µ—Ä—Ç —á–∏—Å—Ç–æ—Ç—ã', desc: '10 –æ—Ü–µ–Ω–æ–∫ –ø–æ —á–∏—Å—Ç–æ—Ç–µ', earned: false },
            parkExpert: { icon: 'üå≥', name: '–ó–Ω–∞—Ç–æ–∫ –ø–∞—Ä–∫–æ–≤', desc: '–û—Ü–µ–Ω–∏–ª 5 –ø–∞—Ä–∫–æ–≤', earned: false },
            ideaGenerator: { icon: 'üí°', name: '–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∏–¥–µ–π', desc: '–ü—Ä–µ–¥–ª–æ–∂–∏–ª 5 –∏–¥–µ–π', earned: false },
            cityCreator: { icon: 'üëë', name: '–°–æ–∑–¥–∞—Ç–µ–ª—å –≥–æ—Ä–æ–¥–∞', desc: '–¢–æ–ø 1% –∞–∫—Ç–∏–≤–Ω—ã—Ö', earned: false },
            safetyExpert: { icon: 'üõ°Ô∏è', name: '–≠–∫—Å–ø–µ—Ä—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏', desc: '10 –æ—Ü–µ–Ω–æ–∫ –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏', earned: false },
            greeneryExpert: { icon: 'üåø', name: '–≠–∫—Å–ø–µ—Ä—Ç –æ–∑–µ–ª–µ–Ω–µ–Ω–∏—è', desc: '10 –æ—Ü–µ–Ω–æ–∫ –ø–æ –æ–∑–µ–ª–µ–Ω–µ–Ω–∏—é', earned: false },
            facilitiesExpert: { icon: 'ü™ë', name: '–≠–∫—Å–ø–µ—Ä—Ç –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã', desc: '10 –æ—Ü–µ–Ω–æ–∫ –ø–æ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–µ', earned: false }
        };

        const LEVELS = [
            { name: '–ù–æ–≤–∏—á–æ–∫', minRatings: 0 },
            { name: '–ñ–∏—Ç–µ–ª—å', minRatings: 3 },
            { name: '–ê–∫—Ç–∏–≤–∏—Å—Ç', minRatings: 10 },
            { name: '–≠–∫—Å–ø–µ—Ä—Ç', minRatings: 25 },
            { name: '–°–æ–∑–¥–∞—Ç–µ–ª—å –≥–æ—Ä–æ–¥–∞', minRatings: 50 }
        ];

        // –î–∞–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç–æ–≤ –ë–∞—Ä–Ω–∞—É–ª–∞
        let locations = [
            {
                id: 1,
                name: "–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –ø–∞—Ä–∫ –∫—É–ª—å—Ç—É—Ä—ã –∏ –æ—Ç–¥—ã—Ö–∞ –∏–º. –í. –ú. –®—É–∫—à–∏–Ω–∞",
                lat: 53.3606,
                lng: 83.7636,
                category: "–ü–∞—Ä–∫",
                rating: 0,
                votes: 0,
                photo: null,
                criteria: { cleanliness: 0, facilities: 0, greenery: 0, safety: 0, overall: 0 },
                description: "–ö—Ä—É–ø–Ω–µ–π—à–∏–π –ø–∞—Ä–∫ –∫—É–ª—å—Ç—É—Ä—ã –∏ –æ—Ç–¥—ã—Ö–∞ –≤ –ë–∞—Ä–Ω–∞—É–ª–µ, –Ω–∞–∑–≤–∞–Ω–Ω—ã–π –≤ —á–µ—Å—Ç—å –∑–Ω–∞–º–µ–Ω–∏—Ç–æ–≥–æ –ø–∏—Å–∞—Ç–µ–ª—è, –∞–∫—Ç—ë—Ä–∞ –∏ —Ä–µ–∂–∏—Å—Å—ë—Ä–∞ –í–∞—Å–∏–ª–∏—è –®—É–∫—à–∏–Ω–∞.",
                address: "—É–ª. –Æ—Ä–∏–Ω–∞, 204"
            },
            {
                id: 2,
                name: "–ù–∞–≥–æ—Ä–Ω—ã–π –ø–∞—Ä–∫",
                lat: 53.3489,
                lng: 83.7773,
                category: "–ü–∞—Ä–∫",
                rating: 0,
                votes: 0,
                photo: null,
                criteria: { cleanliness: 0, facilities: 0, greenery: 0, safety: 0, overall: 0 },
                description: "–ü–∞—Ä–∫ –Ω–∞ –≤–æ–∑–≤—ã—à–µ–Ω–Ω–æ—Å—Ç–∏ —Å –∂–∏–≤–æ–ø–∏—Å–Ω—ã–º –≤–∏–¥–æ–º –Ω–∞ –≥–æ—Ä–æ–¥ –∏ —Ä–µ–∫—É –û–±—å.",
                address: "–ù–∞–≥–æ—Ä–Ω—ã–π –ø–∞—Ä–∫, –ë–∞—Ä–Ω–∞—É–ª"
            },
            {
                id: 3,
                name: "–ü–ª–æ—â–∞–¥—å –û–∫—Ç—è–±—Ä—è",
                lat: 53.3547,
                lng: 83.7678,
                category: "–ü–ª–æ—â–∞–¥—å",
                rating: 0,
                votes: 0,
                photo: null,
                criteria: { cleanliness: 0, facilities: 0, greenery: 0, safety: 0, overall: 0 },
                description: "–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –ø–ª–æ—â–∞–¥—å –≥–æ—Ä–æ–¥–∞, –º–µ—Å—Ç–æ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è –º–∞—Å—Å–æ–≤—ã—Ö –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π –∏ –ø—Ä–∞–∑–¥–Ω–∏–∫–æ–≤.",
                address: "–ü–ª–æ—â–∞–¥—å –û–∫—Ç—è–±—Ä—è, –ë–∞—Ä–Ω–∞—É–ª"
            },
            {
                id: 4,
                name: "–ü–∞—Ä–∫ ¬´–Æ–∂–Ω—ã–π¬ª",
                lat: 53.3314,
                lng: 83.7686,
                category: "–ü–∞—Ä–∫",
                rating: 0,
                votes: 0,
                photo: null,
                criteria: { cleanliness: 0, facilities: 0, greenery: 0, safety: 0, overall: 0 },
                description: "–ë–ª–∞–≥–æ—É—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –ø–∞—Ä–∫ –≤ –Æ–∂–Ω–æ–º –º–∏–∫—Ä–æ—Ä–∞–π–æ–Ω–µ —Å —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π.",
                address: "–Æ–∂–Ω—ã–π –º–∏–∫—Ä–æ—Ä–∞–π–æ–Ω, –ë–∞—Ä–Ω–∞—É–ª"
            },
            {
                id: 5,
                name: "–ù–∞–±–µ—Ä–µ–∂–Ω–∞—è –û–±–∏ (–æ—Ç –º–æ—Å—Ç–∞ –¥–æ –¶–ü–ö–∏–û)",
                lat: 53.3667,
                lng: 83.7586,
                category: "–ù–∞–±–µ—Ä–µ–∂–Ω–∞—è",
                rating: 0,
                votes: 0,
                photo: null,
                criteria: { cleanliness: 0, facilities: 0, greenery: 0, safety: 0, overall: 0 },
                description: "–ë–ª–∞–≥–æ—É—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –Ω–∞–±–µ—Ä–µ–∂–Ω–∞—è —Ä–µ–∫–∏ –û–±—å —Å –ø–µ—à–µ—Ö–æ–¥–Ω—ã–º–∏ –∑–æ–Ω–∞–º–∏ –∏ –≤–∏–¥–∞–º–∏ –Ω–∞ —Ä–µ–∫—É.",
                address: "–ù–∞–±–µ—Ä–µ–∂–Ω–∞—è –û–±–∏, –ë–∞—Ä–Ω–∞—É–ª"
            },
            {
                id: 6,
                name: "–°–∫–≤–µ—Ä –∏–º. –õ–µ–Ω–∏–Ω–∞",
                lat: 53.3601,
                lng: 83.7682,
                category: "–°–∫–≤–µ—Ä",
                rating: 0,
                votes: 0,
                photo: null,
                criteria: { cleanliness: 0, facilities: 0, greenery: 0, safety: 0, overall: 0 },
                description: "–ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–π —Å–∫–≤–µ—Ä –≤ —Ü–µ–Ω—Ç—Ä–µ –≥–æ—Ä–æ–¥–∞ —Å –ø–∞–º—è—Ç–Ω–∏–∫–æ–º –í.–ò. –õ–µ–Ω–∏–Ω—É.",
                address: "–°–∫–≤–µ—Ä –∏–º. –õ–µ–Ω–∏–Ω–∞, –ë–∞—Ä–Ω–∞—É–ª"
            },
            {
                id: 7,
                name: "–ü–∞—Ä–∫ ¬´–î–µ—Ç—Å–∫–∏–π¬ª (–Æ–∂–Ω—ã–π –º–∏–∫—Ä–æ—Ä–∞–π–æ–Ω)",
                lat: 53.3268,
                lng: 83.7814,
                category: "–ü–∞—Ä–∫",
                rating: 0,
                votes: 0,
                photo: null,
                criteria: { cleanliness: 0, facilities: 0, greenery: 0, safety: 0, overall: 0 },
                description: "–°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–∞—Ä–∫ –¥–ª—è –¥–µ—Ç–µ–π —Å –∏–≥—Ä–æ–≤—ã–º–∏ –∏ —Å–ø–æ—Ä—Ç–∏–≤–Ω—ã–º–∏ –ø–ª–æ—â–∞–¥–∫–∞–º–∏.",
                address: "–Æ–∂–Ω—ã–π –º–∏–∫—Ä–æ—Ä–∞–π–æ–Ω, –ë–∞—Ä–Ω–∞—É–ª"
            },
            {
                id: 8,
                name: "–ü–ª–æ—â–∞–¥—å –°–ª–∞–≤—ã",
                lat: 53.3572,
                lng: 83.7589,
                category: "–ü–ª–æ—â–∞–¥—å",
                rating: 0,
                votes: 0,
                photo: null,
                criteria: { cleanliness: 0, facilities: 0, greenery: 0, safety: 0, overall: 0 },
                description: "–ú–µ–º–æ—Ä–∏–∞–ª—å–Ω–∞—è –ø–ª–æ—â–∞–¥—å, –ø–æ—Å–≤—è—â—ë–Ω–Ω–∞—è –≥–µ—Ä–æ—è–º –í–µ–ª–∏–∫–æ–π –û—Ç–µ—á–µ—Å—Ç–≤–µ–Ω–Ω–æ–π –≤–æ–π–Ω—ã.",
                address: "–ü–ª–æ—â–∞–¥—å –°–ª–∞–≤—ã, –ë–∞—Ä–Ω–∞—É–ª"
            },
            {
                id: 9,
                name: "–ë—É–ª—å–≤–∞—Ä –ü–æ–±–µ–¥—ã",
                lat: 53.3514,
                lng: 83.7842,
                category: "–ë—É–ª—å–≤–∞—Ä",
                rating: 0,
                votes: 0,
                photo: null,
                criteria: { cleanliness: 0, facilities: 0, greenery: 0, safety: 0, overall: 0 },
                description: "–ü–µ—à–µ—Ö–æ–¥–Ω—ã–π –±—É–ª—å–≤–∞—Ä —Å –∞–ª–ª–µ–µ–π –ø–∞–º—è—Ç–∏ –≥–µ—Ä–æ—è–º –í–µ–ª–∏–∫–æ–π –û—Ç–µ—á–µ—Å—Ç–≤–µ–Ω–Ω–æ–π –≤–æ–π–Ω—ã.",
                address: "–ë—É–ª—å–≤–∞—Ä –ü–æ–±–µ–¥—ã, –ë–∞—Ä–Ω–∞—É–ª"
            },
            {
                id: 10,
                name: "–ü–∞—Ä–∫ ¬´–õ–µ—Å–Ω–∞—è —Å–∫–∞–∑–∫–∞¬ª",
                lat: 53.3403,
                lng: 83.7511,
                category: "–ü–∞—Ä–∫",
                rating: 0,
                votes: 0,
                photo: null,
                criteria: { cleanliness: 0, facilities: 0, greenery: 0, safety: 0, overall: 0 },
                description: "–õ–µ—Å–æ–ø–∞—Ä–∫–æ–≤–∞—è –∑–æ–Ω–∞ —Å —ç–∫–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–º–∏ —Ç—Ä–æ–ø–∞–º–∏ –∏ –∑–æ–Ω–∞–º–∏ –æ—Ç–¥—ã—Ö–∞.",
                address: "–ü–∞—Ä–∫ ¬´–õ–µ—Å–Ω–∞—è —Å–∫–∞–∑–∫–∞¬ª, –ë–∞—Ä–Ω–∞—É–ª"
            }
        ];

        let currentUser = {
            name: "–ò–≥—Ä–æ–∫",
            ratings: 0,
            ideas: 0,
            badges: [],
            level: 0,
            ratedLocations: [],
            photoUploads: 0
        };

        let ideas = [];
        let currentRatingLocation = null;
        let map;
        let markers = [];
        let isAdminMode = false; // –†–µ–∂–∏–º –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

        // ========== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ==========
        document.addEventListener('DOMContentLoaded', function() {
            loadFromStorage();
            initMap();
            initNavigation();
            initStarRatings();
            initPhotoUpload();
            initModeSwitcher(); // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—è —Ä–µ–∂–∏–º–∞
            updateStats();
            updateRatingList();
            updateIdeasList();
            initCharts();
            updatePhotoUploadUI(); // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ-–ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ
            setTimeout(() => {
                showNotification('üéÆ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –∏–≥—Ä—É "–°–æ–∑–¥–∞–π –∏–¥–µ–∞–ª—å–Ω—ã–π –ë–∞—Ä–Ω–∞—É–ª"!', 'success');
            }, 1000);
        });

        // ========== –ü–ï–†–ï–ö–õ–Æ–ß–ê–¢–ï–õ–¨ –†–ï–ñ–ò–ú–ê ==========
        function initModeSwitcher() {
            document.querySelectorAll('.mode-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const mode = this.getAttribute('data-mode');
                    switchMode(mode);
                });
            });
        }

        function switchMode(mode) {
            isAdminMode = mode === 'admin';
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –∫–Ω–æ–ø–∫—É
            document.querySelectorAll('.mode-btn').forEach(btn => {
                btn.classList.toggle('active', btn.getAttribute('data-mode') === mode);
            });
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ
            updatePhotoUploadUI();
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            const modeText = isAdminMode ? '–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞' : '–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è';
            showNotification(`–†–µ–∂–∏–º ${modeText} –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω`, 'info');
            
            // –ï—Å–ª–∏ –æ—Ç–∫—Ä—ã—Ç–æ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ, –æ–±–Ω–æ–≤–ª—è–µ–º –µ–≥–æ
            if (document.getElementById('ratingModal').style.display === 'flex') {
                updatePhotoUploadUI();
            }
        }

        function updatePhotoUploadUI() {
            const uploadArea = document.getElementById('photoUploadArea');
            const uploadText = document.getElementById('photoUploadText');
            
            if (isAdminMode) {
                uploadArea.style.borderColor = 'var(--success)';
                uploadText.textContent = '–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–æ—Ç–æ —Å—é–¥–∞ –∏–ª–∏ –∫–ª–∏–∫–Ω–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞ (—Ä–µ–∂–∏–º –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞)';
                uploadText.style.color = 'var(--success)';
            } else {
                uploadArea.style.borderColor = 'var(--primary-light)';
                uploadText.textContent = '–ó–∞–≥—Ä—É–∑–∫—É —Ñ–æ—Ç–æ –º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä';
                uploadText.style.color = 'var(--gray)';
            }
        }

        // ========== –•–†–ê–ù–ï–ù–ò–ï –î–ê–ù–ù–´–• ==========
        function saveToStorage() {
            const data = {
                locations,
                currentUser,
                ideas,
                lastUpdate: new Date().getTime()
            };
            localStorage.setItem('cityIdeasBarnaul', JSON.stringify(data));
        }

        function loadFromStorage() {
            const saved = localStorage.getItem('cityIdeasBarnaul');
            if (saved) {
                try {
                    const data = JSON.parse(saved);
                    locations = data.locations || locations;
                    currentUser = data.currentUser || currentUser;
                    ideas = data.ideas || ideas;
                } catch (e) {
                    console.log('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö');
                }
            }
        }

        // ========== –ö–ê–†–¢–ê ==========
        function initMap() {
            map = L.map('map').setView([53.3606, 83.7637], 13);
            
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '¬© OpenStreetMap contributors'
            }).addTo(map);
            
            // –î–æ–±–∞–≤–ª—è–µ–º –º–∞—Ä–∫–µ—Ä—ã
            locations.forEach(location => {
                const marker = L.marker([location.lat, location.lng], {
                    icon: L.divIcon({
                        className: 'custom-marker',
                        html: `<div style="
                            width: 50px;
                            height: 50px;
                            background: ${location.votes > 0 ? 'var(--primary)' : 'var(--gray)'};
                            border: 3px solid white;
                            border-radius: 50%;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            color: white;
                            font-weight: bold;
                            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
                            cursor: pointer;
                        ">
                            <i class="fas fa-map-marker-alt"></i>
                        </div>`,
                        iconSize: [50, 50],
                        iconAnchor: [25, 50]
                    })
                }).addTo(map);
                
                marker.on('click', () => {
                    openRatingModal(location.id);
                });
                
                markers.push(marker);
            });
        }

        function showAllLocations() {
            map.setView([53.3606, 83.7637], 13);
            showNotification('–í—Å–µ 10 —Ç–æ—á–µ–∫ –ë–∞—Ä–Ω–∞—É–ª–∞ –æ—Ç–º–µ—á–µ–Ω—ã –Ω–∞ –∫–∞—Ä—Ç–µ', 'info');
        }

        // ========== –ù–ê–í–ò–ì–ê–¶–ò–Ø ==========
        function initNavigation() {
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const page = this.getAttribute('data-page');
                    switchPage(page);
                });
            });
        }

        function switchPage(pageId) {
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Å–æ –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
            document.getElementById(pageId).classList.add('active');
            
            // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é –∫–Ω–æ–ø–∫—É
            document.querySelector(`[data-page="${pageId}"]`).classList.add('active');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
            if (pageId === 'profile') updateProfile();
            if (pageId === 'rating') updateRatingList();
            if (pageId === 'ideas') updateIdeasList();
            if (pageId === 'analytics') updateCharts();
        }

        // ========== –°–¢–ê–¢–ò–°–¢–ò–ö–ê ==========
        function updateStats() {
            const totalRatings = locations.reduce((sum, loc) => sum + loc.votes, 0);
            const totalIdeas = ideas.length;
            const activeUsers = Math.floor(totalRatings / 3); // –ü—Ä–∏–º–µ—Ä–Ω–∞—è –ª–æ–≥–∏–∫–∞
            const completedIdeas = ideas.filter(i => i.status === 'done').length;
            
            document.getElementById('totalRatings').textContent = totalRatings;
            document.getElementById('totalIdeas').textContent = totalIdeas;
            document.getElementById('activeUsers').textContent = activeUsers;
            document.getElementById('completedIdeas').textContent = completedIdeas;
            
            // –ü—Ä–æ–≥—Ä–µ—Å—Å –≥–æ—Ä–æ–¥–∞
            const progress = Math.min((totalRatings / 1000) * 100, 100);
            document.getElementById('cityProgress').style.width = progress + '%';
            document.getElementById('progressText').textContent = `${totalRatings}/1000 –æ—Ü–µ–Ω–æ–∫`;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –±–µ–π–¥–∂–∏ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π
            updateBadgesPreview();
            
            saveToStorage();
        }

        // ========== –ü–†–û–§–ò–õ–¨ ==========
        function updateProfile() {
            document.getElementById('userName').textContent = currentUser.name;
            document.getElementById('userRatings').textContent = currentUser.ratings;
            document.getElementById('userIdeas').textContent = currentUser.ideas;
            document.getElementById('userBadgesCount').textContent = currentUser.badges.length;
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —É—Ä–æ–≤–µ–Ω—å
            const userLevel = LEVELS.findIndex(level => currentUser.ratings >= level.minRatings);
            const nextLevel = LEVELS[userLevel + 1] || LEVELS[LEVELS.length - 1];
            document.getElementById('userLevel').textContent = `–£—Ä–æ–≤–µ–Ω—å: ${LEVELS[userLevel].name}`;
            
            // –ü—Ä–æ–≥—Ä–µ—Å—Å –¥–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ —É—Ä–æ–≤–Ω—è
            const progress = nextLevel ? (currentUser.ratings / nextLevel.minRatings) * 100 : 100;
            document.getElementById('userProgress').style.width = Math.min(progress, 100) + '%';
            document.getElementById('userProgressText').textContent = nextLevel ? 
                `${currentUser.ratings}/${nextLevel.minRatings} –æ—Ü–µ–Ω–æ–∫` : '–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å!';
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –±–µ–π–¥–∂–∏
            updateBadgesFull();
        }

        // ========== –ë–ï–ô–î–ñ–ò ==========
        function updateBadgesPreview() {
            const container = document.getElementById('userBadgesPreview');
            container.innerHTML = '';
            
            Object.entries(BADGES).slice(0, 4).forEach(([key, badge]) => {
                const isEarned = currentUser.badges.includes(key);
                const badgeEl = document.createElement('div');
                badgeEl.className = `badge ${isEarned ? '' : 'locked'}`;
                badgeEl.innerHTML = `
                    <div class="badge-icon">${badge.icon}</div>
                    <h4>${badge.name}</h4>
                    <p style="font-size: 0.8rem; color: var(--gray);">${badge.desc}</p>
                `;
                container.appendChild(badgeEl);
            });
        }

        function updateBadgesFull() {
            const container = document.getElementById('userBadgesFull');
            container.innerHTML = '';
            
            Object.entries(BADGES).forEach(([key, badge]) => {
                const isEarned = currentUser.badges.includes(key);
                const badgeEl = document.createElement('div');
                badgeEl.className = `badge ${isEarned ? '' : 'locked'}`;
                badgeEl.innerHTML = `
                    <div class="badge-icon">${badge.icon}</div>
                    <h4>${badge.name}</h4>
                    <p style="font-size: 0.8rem; color: var(--gray);">${badge.desc}</p>
                    ${isEarned ? '<div style="color: var(--success); margin-top: 0.5rem;">‚úì –ü–æ–ª—É—á–µ–Ω</div>' : 
                                 '<div style="color: var(--gray); margin-top: 0.5rem;">üîí –ù–µ –ø–æ–ª—É—á–µ–Ω</div>'}
                `;
                container.appendChild(badgeEl);
            });
        }

        function checkAndAwardBadges() {
            const newBadges = [];
            
            // –ü–µ—Ä–≤–∞—è –æ—Ü–µ–Ω–∫–∞
            if (currentUser.ratings === 1 && !currentUser.badges.includes('firstRating')) {
                newBadges.push('firstRating');
                showNotification(`üéâ –ü–æ–ª—É—á–µ–Ω –±–µ–π–¥–∂: "${BADGES.firstRating.name}"!`, 'success');
                createConfetti();
            }
            
            // 10 –æ—Ü–µ–Ω–æ–∫ –ø–æ —á–∏—Å—Ç–æ—Ç–µ
            if (currentUser.ratings >= 10 && !currentUser.badges.includes('cleanExpert')) {
                newBadges.push('cleanExpert');
                showNotification(`üèÜ –ü–æ–ª—É—á–µ–Ω –±–µ–π–¥–∂: "${BADGES.cleanExpert.name}"!`, 'success');
                createConfetti();
            }
            
            // 5 –ø–∞—Ä–∫–æ–≤
            const ratedParks = locations.filter(l => 
                l.category === '–ü–∞—Ä–∫' && currentUser.ratedLocations.includes(l.id)
            ).length;
            if (ratedParks >= 5 && !currentUser.badges.includes('parkExpert')) {
                newBadges.push('parkExpert');
                showNotification(`üå≥ –ü–æ–ª—É—á–µ–Ω –±–µ–π–¥–∂: "${BADGES.parkExpert.name}"!`, 'success');
                createConfetti();
            }
            
            // 5 –∏–¥–µ–π
            if (currentUser.ideas >= 5 && !currentUser.badges.includes('ideaGenerator')) {
                newBadges.push('ideaGenerator');
                showNotification(`üí° –ü–æ–ª—É—á–µ–Ω –±–µ–π–¥–∂: "${BADGES.ideaGenerator.name}"!`, 'success');
                createConfetti();
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ –±–µ–π–¥–∂–∏
            currentUser.badges = [...new Set([...currentUser.badges, ...newBadges])];
            updateBadgesPreview();
        }

        // ========== –†–ï–ô–¢–ò–ù–ì ==========
        function updateRatingList() {
            const container = document.getElementById('ratingList');
            container.innerHTML = '';
            
            // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ —Ä–µ–π—Ç–∏–Ω–≥—É
            const sorted = [...locations].sort((a, b) => b.rating - a.rating);
            
            sorted.forEach((location, index) => {
                const card = document.createElement('div');
                card.className = 'location-card';
                card.onclick = () => openRatingModal(location.id);
                
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä
                let indicatorClass = 'none';
                if (location.votes > 0) {
                    if (location.rating >= 4) indicatorClass = 'high';
                    else if (location.rating >= 2.5) indicatorClass = 'medium';
                    else indicatorClass = 'low';
                }
                
                card.innerHTML = `
                    <div class="location-rank">${index + 1}</div>
                    <div class="rating-indicator ${indicatorClass}"></div>
                    <div style="flex: 1;">
                        <h3 style="margin-bottom: 0.5rem; color: var(--dark);">${location.name}</h3>
                        <div style="display: flex; align-items: center; gap: 1rem;">
                            <div class="location-rating">${location.rating.toFixed(1)}</div>
                            <div style="color: var(--warning); font-size: 1.2rem;">
                                ${'‚òÖ'.repeat(Math.floor(location.rating))}${'‚òÜ'.repeat(5-Math.floor(location.rating))}
                            </div>
                        </div>
                        <p style="color: var(--gray); margin-top: 0.5rem; font-size: 0.9rem;">
                            <i class="fas fa-users"></i> ${location.votes} –æ—Ü–µ–Ω–æ–∫ | 
                            <i class="fas fa-tag"></i> ${location.category}
                        </p>
                    </div>
                    <button class="btn btn-secondary" onclick="event.stopPropagation(); openRatingModal(${location.id})">
                        <i class="fas fa-star"></i> –û—Ü–µ–Ω–∏—Ç—å
                    </button>
                `;
                
                container.appendChild(card);
            });
        }

        function sortByRating() {
            locations.sort((a, b) => b.rating - a.rating);
            updateRatingList();
            showNotification('–û—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ –ø–æ —Ä–µ–π—Ç–∏–Ω–≥—É', 'info');
        }

        function sortByVotes() {
            locations.sort((a, b) => b.votes - a.votes);
            updateRatingList();
            showNotification('–û—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –æ—Ü–µ–Ω–æ–∫', 'info');
        }

        // ========== –ò–î–ï–ò ==========
        function updateIdeasList() {
            // –ó–∞–ø–æ–ª–Ω—è–µ–º –≤—ã–ø–∞–¥–∞—é—â–∏–π —Å–ø–∏—Å–æ–∫
            const select = document.getElementById('ideaLocation');
            select.innerHTML = '<option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –æ–±—ä–µ–∫—Ç --</option>';
            locations.forEach(location => {
                const option = document.createElement('option');
                option.value = location.id;
                option.textContent = location.name;
                select.appendChild(option);
            });
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –∏–¥–µ–π
            const container = document.getElementById('ideasList');
            container.innerHTML = '';
            
            if (ideas.length === 0) {
                container.innerHTML = '<p style="color: var(--gray); text-align: center; padding: 2rem;">–ò–¥–µ–π –ø–æ–∫–∞ –Ω–µ—Ç</p>';
                return;
            }
            
            ideas.slice().reverse().forEach(idea => {
                const location = locations.find(l => l.id === idea.locationId);
                const item = document.createElement('div');
                item.className = 'idea-item';
                
                item.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 1rem;">
                        <div>
                            <h4 style="color: var(--dark); margin-bottom: 0.5rem;">${idea.title || '–ò–¥–µ—è'}</h4>
                            <p style="color: var(--gray); font-size: 0.9rem;">
                                <i class="fas fa-map-marker-alt"></i> ${location?.name || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}
                            </p>
                        </div>
                        <span class="idea-status status-${idea.status}">${getStatusText(idea.status)}</span>
                    </div>
                    <p style="color: var(--dark); margin-bottom: 1rem;">${idea.description}</p>
                    <div style="display: flex; justify-content: space-between; color: var(--gray); font-size: 0.8rem;">
                        <span>${formatDate(idea.date)}</span>
                        <span>${idea.category}</span>
                    </div>
                `;
                
                container.appendChild(item);
            });
        }

        function submitIdea(event) {
            event.preventDefault();
            
            const locationId = parseInt(document.getElementById('ideaLocation').value);
            const category = document.getElementById('ideaCategory').value;
            const description = document.getElementById('ideaDescription').value;
            const email = document.getElementById('ideaEmail').value;
            
            if (!locationId || !category || !description) {
                showNotification('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è', 'error');
                return;
            }
            
            const newIdea = {
                id: Date.now(),
                locationId,
                category,
                description,
                email,
                status: 'pending',
                date: new Date().toISOString(),
                title: `–ò–¥–µ—è –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è`
            };
            
            ideas.push(newIdea);
            currentUser.ideas++;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –±–µ–π–¥–∂–∏
            checkAndAwardBadges();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            updateIdeasList();
            updateStats();
            
            // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É
            document.getElementById('ideaForm').reset();
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            showNotification('üí° –ò–¥–µ—è —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞! –°–ø–∞—Å–∏–±–æ –∑–∞ –≤–∞—à –≤–∫–ª–∞–¥.', 'success');
            createConfetti();
            
            saveToStorage();
        }

        // ========== –û–¶–ï–ù–ö–ò ==========
        function initStarRatings() {
            ['cleanliness', 'facilities', 'greenery', 'safety', 'overall'].forEach(type => {
                const container = document.getElementById(`${type}Rating`);
                if (container) {
                    container.querySelectorAll('.star').forEach(star => {
                        star.addEventListener('click', function() {
                            const value = parseInt(this.getAttribute('data-value'));
                            setStars(container, value);
                        });
                    });
                }
            });
        }

        function setStars(container, value) {
            container.querySelectorAll('.star').forEach((star, index) => {
                if (index < value) {
                    star.classList.add('active');
                } else {
                    star.classList.remove('active');
                }
            });
        }

        function getStarValue(container) {
            const stars = container.querySelectorAll('.star');
            for (let i = stars.length; i > 0; i--) {
                if (stars[i-1].classList.contains('active')) {
                    return i;
                }
            }
            return 0;
        }

        function openRatingModal(locationId) {
            const location = locations.find(l => l.id === locationId);
            if (!location) return;
            
            currentRatingLocation = location;
            document.getElementById('ratingLocationName').textContent = location.name;
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∑–≤—ë–∑–¥—ã
            ['cleanliness', 'facilities', 'greenery', 'safety', 'overall'].forEach(type => {
                setStars(document.getElementById(`${type}Rating`), 0);
            });
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ —Ñ–æ—Ç–æ, –µ—Å–ª–∏ –µ—Å—Ç—å
            const preview = document.getElementById('photoPreview');
            if (location.photo) {
                preview.src = location.photo;
                preview.style.display = 'block';
            } else {
                preview.style.display = 'none';
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∑–∞–≥—Ä—É–∑–∫–∏
            updatePhotoUploadUI();
            
            document.getElementById('ratingModal').style.display = 'flex';
        }

        function closeRatingModal() {
            document.getElementById('ratingModal').style.display = 'none';
        }

        function initPhotoUpload() {
            const fileInput = document.getElementById('photoInput');
            const preview = document.getElementById('photoPreview');
            
            fileInput.addEventListener('change', function(e) {
                if (!isAdminMode) {
                    showNotification('–¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å —Ñ–æ—Ç–æ', 'error');
                    return;
                }
                
                const file = e.target.files[0];
                if (file && file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        preview.src = e.target.result;
                        preview.style.display = 'block';
                    };
                    reader.readAsDataURL(file);
                    showNotification('–§–æ—Ç–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º', 'success');
                }
            });
        }

        function submitLocationRating() {
            if (!currentRatingLocation) return;
            
            // –ü–æ–ª—É—á–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –æ—Ü–µ–Ω–æ–∫
            const ratings = {
                cleanliness: getStarValue(document.getElementById('cleanlinessRating')),
                facilities: getStarValue(document.getElementById('facilitiesRating')),
                greenery: getStarValue(document.getElementById('greeneryRating')),
                safety: getStarValue(document.getElementById('safetyRating')),
                overall: getStarValue(document.getElementById('overallRating'))
            };
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –∫—Ä–∏—Ç–µ—Ä–∏–π –æ—Ü–µ–Ω–µ–Ω
            const hasRating = Object.values(ratings).some(r => r > 0);
            if (!hasRating) {
                showNotification('–ü–æ—Å—Ç–∞–≤—å—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω—É –æ—Ü–µ–Ω–∫—É', 'error');
                return;
            }
            
            // –ü–æ–ª—É—á–∞–µ–º —Ñ–æ—Ç–æ (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä)
            const preview = document.getElementById('photoPreview');
            if (preview.style.display !== 'none' && preview.src && isAdminMode) {
                currentRatingLocation.photo = preview.src;
                showNotification('–§–æ—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º', 'success');
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–µ–π—Ç–∏–Ω–≥
            const location = currentRatingLocation;
            const oldVotes = location.votes;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞–∂–¥—ã–π –∫—Ä–∏—Ç–µ—Ä–∏–π
            Object.keys(ratings).forEach(key => {
                if (ratings[key] > 0) {
                    const oldValue = location.criteria[key] || 0;
                    location.criteria[key] = oldVotes === 0 ? 
                        ratings[key] : 
                        (oldValue * oldVotes + ratings[key]) / (oldVotes + 1);
                }
            });
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ–±—â–∏–π —Ä–µ–π—Ç–∏–Ω–≥
            const criteriaValues = Object.values(location.criteria).filter(v => v > 0);
            location.rating = criteriaValues.length > 0 ? 
                criteriaValues.reduce((a, b) => a + b) / criteriaValues.length : 0;
            location.votes++;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            if (!currentUser.ratedLocations.includes(location.id)) {
                currentUser.ratedLocations.push(location.id);
            }
            currentUser.ratings++;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –±–µ–π–¥–∂–∏
            checkAndAwardBadges();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            updateStats();
            updateRatingList();
            updateProfile();
            
            // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
            closeRatingModal();
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Å –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è–º–∏
            showNotification(
                `‚≠ê –û—Ü–µ–Ω–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞! –¢–≤–æ–π –≤–∫–ª–∞–¥: ${currentUser.ratings} –æ—Ü–µ–Ω–æ–∫.`, 
                'success'
            );
            createConfetti();
            
            saveToStorage();
        }

        // ========== –ê–ù–ê–õ–ò–¢–ò–ö–ê –ò –ì–†–ê–§–ò–ö–ò ==========
        function initCharts() {
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≥—Ä–∞—Ñ–∏–∫–æ–≤
            window.criteriaChart = new Chart(document.getElementById('criteriaChart'), {
                type: 'bar',
                data: getCriteriaData(),
                options: {
                    responsive: true,
                    plugins: {
                        legend: { position: 'top' }
                    }
                }
            });
            
            window.activityChart = new Chart(document.getElementById('activityChart'), {
                type: 'line',
                data: getActivityData(),
                options: {
                    responsive: true,
                    plugins: {
                        legend: { position: 'top' }
                    }
                }
            });
            
            window.ideasChart = new Chart(document.getElementById('ideasChart'), {
                type: 'doughnut',
                data: getIdeasData(),
                options: {
                    responsive: true,
                    plugins: {
                        legend: { position: 'top' }
                    }
                }
            });
            
            window.problemsChart = new Chart(document.getElementById('problemsChart'), {
                type: 'radar',
                data: getProblemsData(),
                options: {
                    responsive: true,
                    plugins: {
                        legend: { position: 'top' }
                    }
                }
            });
        }

        function updateCharts() {
            if (window.criteriaChart) {
                window.criteriaChart.data = getCriteriaData();
                window.criteriaChart.update();
            }
            
            if (window.activityChart) {
                window.activityChart.data = getActivityData();
                window.activityChart.update();
            }
            
            if (window.ideasChart) {
                window.ideasChart.data = getIdeasData();
                window.ideasChart.update();
            }
            
            if (window.problemsChart) {
                window.problemsChart.data = getProblemsData();
                window.problemsChart.update();
            }
        }

        function getCriteriaData() {
            const criteria = ['cleanliness', 'facilities', 'greenery', 'safety', 'overall'];
            const labels = ['–ß–∏—Å—Ç–æ—Ç–∞', '–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞', '–û–∑–µ–ª–µ–Ω–µ–Ω–∏–µ', '–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å', '–û–±—â–µ–µ'];
            const data = criteria.map(c => {
                const total = locations.reduce((sum, loc) => sum + (loc.criteria[c] || 0), 0);
                const count = locations.filter(loc => loc.criteria[c] > 0).length;
                return count > 0 ? (total / count) : 0;
            });
            
            return {
                labels: labels,
                datasets: [{
                    label: '–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª',
                    data: data,
                    backgroundColor: 'rgba(37, 99, 235, 0.5)',
                    borderColor: 'rgb(37, 99, 235)',
                    borderWidth: 1
                }]
            };
        }

        function getActivityData() {
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π
            const days = ['–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±', '–í—Å'];
            const data = days.map(() => Math.floor(Math.random() * 20) + 5);
            
            return {
                labels: days,
                datasets: [{
                    label: '–û—Ü–µ–Ω–æ–∫ –≤ –¥–µ–Ω—å',
                    data: data,
                    borderColor: 'rgb(139, 92, 246)',
                    backgroundColor: 'rgba(139, 92, 246, 0.1)',
                    tension: 0.4
                }]
            };
        }

        function getIdeasData() {
            const categories = ['–ß–∏—Å—Ç–æ—Ç–∞', '–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞', '–û–∑–µ–ª–µ–Ω–µ–Ω–∏–µ', '–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å', '–î—Ä—É–≥–æ–µ'];
            const data = [8, 12, 6, 4, 5]; // –ü—Ä–∏–º–µ—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
            
            return {
                labels: categories,
                datasets: [{
                    data: data,
                    backgroundColor: [
                        'rgba(37, 99, 235, 0.7)',
                        'rgba(139, 92, 246, 0.7)',
                        'rgba(16, 185, 129, 0.7)',
                        'rgba(245, 158, 11, 0.7)',
                        'rgba(239, 68, 68, 0.7)'
                    ]
                }]
            };
        }

        function getProblemsData() {
            const locationsWithRatings = locations.filter(l => l.votes > 0).slice(0, 5);
            
            return {
                labels: locationsWithRatings.map(l => l.name.substring(0, 15) + '...'),
                datasets: [{
                    label: '–ü—Ä–æ–±–ª–µ–º–Ω—ã–µ –º–µ—Å—Ç–∞',
                    data: locationsWithRatings.map(l => 5 - l.rating), // –û–±—Ä–∞—Ç–Ω—ã–π —Ä–µ–π—Ç–∏–Ω–≥
                    backgroundColor: 'rgba(239, 68, 68, 0.2)',
                    borderColor: 'rgb(239, 68, 68)',
                    pointBackgroundColor: 'rgb(239, 68, 68)'
                }]
            };
        }

        function exportData(format) {
            let data;
            let filename;
            let type;
            
            switch(format) {
                case 'csv':
                    data = convertToCSV();
                    filename = '–≥–æ—Ä–æ–¥_–∏–¥–µ–π_–¥–∞–Ω–Ω—ã–µ.csv';
                    type = 'text/csv';
                    break;
                case 'json':
                    data = JSON.stringify({
                        locations,
                        ideas,
                        stats: {
                            totalRatings: locations.reduce((sum, l) => sum + l.votes, 0),
                            totalIdeas: ideas.length,
                            activeUsers: currentUser.ratings
                        }
                    }, null, 2);
                    filename = '–≥–æ—Ä–æ–¥_–∏–¥–µ–π_–¥–∞–Ω–Ω—ã–µ.json';
                    type = 'application/json';
                    break;
                case 'pdf':
                    // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—ã–ª –±—ã –≤—ã–∑–æ–≤ API –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ PDF
                    showNotification('PDF —ç–∫—Å–ø–æ—Ä—Ç –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ', 'info');
                    return;
            }
            
            const blob = new Blob([data], { type });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
            
            showNotification(`–î–∞–Ω–Ω—ã–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤ ${format.toUpperCase()}`, 'success');
        }

        function convertToCSV() {
            const headers = ['ID', '–ù–∞–∑–≤–∞–Ω–∏–µ', '–ö–∞—Ç–µ–≥–æ—Ä–∏—è', '–†–µ–π—Ç–∏–Ω–≥', '–û—Ü–µ–Ω–æ–∫', '–ß–∏—Å—Ç–æ—Ç–∞', '–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞', '–û–∑–µ–ª–µ–Ω–µ–Ω–∏–µ', '–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å', '–û–±—â–µ–µ'];
            const rows = locations.map(l => [
                l.id,
                `"${l.name}"`,
                l.category,
                l.rating.toFixed(2),
                l.votes,
                l.criteria.cleanliness.toFixed(2),
                l.criteria.facilities.toFixed(2),
                l.criteria.greenery.toFixed(2),
                l.criteria.safety.toFixed(2),
                l.criteria.overall.toFixed(2)
            ]);
            
            return [headers.join(','), ...rows.map(row => row.join(','))].join('\n');
        }

        // ========== –£–¢–ò–õ–ò–¢–´ ==========
        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            const icon = document.getElementById('notificationIcon');
            const title = document.getElementById('notificationTitle');
            const msg = document.getElementById('notificationMessage');
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–∫–æ–Ω–∫—É –∏ —Ü–≤–µ—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞
            switch(type) {
                case 'success':
                    icon.textContent = 'üéâ';
                    notification.style.borderLeft = '4px solid var(--success)';
                    title.textContent = '–£—Å–ø–µ—Ö!';
                    break;
                case 'error':
                    icon.textContent = '‚ö†Ô∏è';
                    notification.style.borderLeft = '4px solid var(--danger)';
                    title.textContent = '–û—à–∏–±–∫–∞!';
                    break;
                case 'info':
                    icon.textContent = '‚ÑπÔ∏è';
                    notification.style.borderLeft = '4px solid var(--primary)';
                    title.textContent = '–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è';
                    break;
            }
            
            msg.textContent = message;
            notification.classList.remove('hidden');
            
            setTimeout(() => {
                notification.classList.add('hidden');
            }, 3000);
        }

        function createConfetti() {
            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.background = getRandomColor();
                document.body.appendChild(confetti);
                
                setTimeout(() => confetti.remove(), 1000);
            }
        }

        function getRandomColor() {
            const colors = ['#2563EB', '#8B5CF6', '#10B981', '#F59E0B', '#EF4444'];
            return colors[Math.floor(Math.random() * colors.length)];
        }

        function getStatusText(status) {
            const statuses = {
                pending: '–ù–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏',
                review: '–í —Ä–∞–±–æ—Ç–µ',
                progress: '–í –ø—Ä–æ—Ü–µ—Å—Å–µ',
                done: '–í—ã–ø–æ–ª–Ω–µ–Ω–æ'
            };
            return statuses[status] || status;
        }

        function formatDate(isoString) {
            const date = new Date(isoString);
            return date.toLocaleDateString('ru-RU');
        }

        // –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ HTML
        window.switchPage = switchPage;
        window.openRatingModal = openRatingModal;
        window.closeRatingModal = closeRatingModal;
        window.submitLocationRating = submitLocationRating;
        window.submitIdea = submitIdea;
        window.sortByRating = sortByRating;
        window.sortByVotes = sortByVotes;
        window.filterByCategory = filterByCategory;
        window.exportData = exportData;
        window.showAllLocations = showAllLocations;
    </script>
</body>
</html>
```
